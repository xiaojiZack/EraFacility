2023/3/4
TODO
    开场剧情，地图，基本交流com

2023/3/7
关于地图的问题
    地图编辑器只能打开第一级的地图文件，如果多层嵌套的话会读取不到。
    地图编辑器只用来生成和修改mapdata是可以的，而且保存的mapdata信息是作为额外的txt，由于仅仅保存了mapdata，所以不会在下一次直接读入初始化
    MapEditor的addspot直接在board对象下存储spot对象，我觉得这是非常丑陋的
    board的get方法通过id来查找对象，
    而board下的spot方法只存储了spotid-{位置，朝向，地点类型，地形}这样的信息，而不存储spot对象。为什么不直接存储spot对象呢，这些信息放在spot对象内就好了。
    如果要和GenerateSpot联动生成地图的话

    有必要使用map吗？
    使用map的好处，类TW的交流模式，露出系指令的具体实现
    地图仅保存地图静态信息，不包含具体的函数处理。
    进出设施相关的逻辑处理交由相关移动指令处理。

    map的初始化逻辑
        ·在setup文件夹下保存map系统的初始化
        ·读取需要初始化的board列表json
        ·根据json内容(mapid, group, obj:{type, name?, entry?, main?, xy?})通过addBoard生成
        ·对生成的Board对象加载其mapdata
        ·读取需要初始化的spot列表json
        ·根据json内容执行spot对应的初始化函数
        ·根据json内容([boardId,spotId,name,spotType])通过addSpot生成
        
2023/3/11
    存档内的地图变更使用flag或者直接一个字典存储patch放在存档数据内。
    mapdata仅仅保存静态数据。

2023/3/15
    关于NPC的移动，是生成移动路径后按照时间节点检查还是按照概率随机出现？
    采用根据人物计划设置人物移动时间刻的效果
    人物包含玩家主控人物
    时间变化->持续性触发->检查所有人物时间表是否有触发事件->按顺序执行所有触发事件->注册新的触发事件->等待下一次时间变化

    持续性触发:Base自然变化,装具变化,药液变化,

    接下来是做时间刻系统

    action 和 com里选一个
    action有placement，autokeep, 涉及到的bodypart

    用com吧
    

2023-3-17
    继续调整com的流程

2023-3-18
    先做更多指令还是先处理一下地图逻辑？比如跳转、访问许可之类的？

2023-3-20
    准入检测，目前只做pc的准入检测
    之后是学院层的其他建筑，教室、放映厅、体育馆、游泳池、办公室、礼堂、商店、食堂、医务室、广播站、图书馆
    spots的isopenhour未完成。

2023-3-21
    今日任务：新的论文+spots的isopenhour+学院层地图

2023-3-22
    今日任务: 


2023-3-29
    模糊化人物信息显示：作为todo吧，首先要对信息进行分级
    做一个日志吧，存储的信息包括:当前日期、当前目标、下一个重要节日、人物列表（接到人物细节属性）、成就？、地图

2023-3-31
    人物信息的模糊化做完了，之后可以添加各种判断条件
    Ipad部分还缺少成就和当前目标还没完成
    人物当前位置还没完成，需要新写一个根据mapid和坐标返回spot对象的函数
    人物的服装外貌考虑用别的描述手法，

2023-4-1
    人物足部等部分没有算在暴露度计算更新内，导致部分衣物（袜子，鞋子）没有暴露度判定

2023-4-18
    人物信息的敏感程度划分
    Sbl,exp,vagirity,body,mark,palam
    关于palam似乎在想有没有必要消除对特定部位的pain划分

2023-4-19
    人物的一些特殊状态，如“睡眠中”，在侧边栏的显示

2023-4-20

    人物心情的划分：
        mood 60以上：乐；
        mood 60以上+favo:喜
        mood 60以上+高favo：爱
        mood 40以下: 悲;
        mood 40以下+高depress: 郁;
        mood 40以下+resist: 厌
        mood 20以下+高resist: 怒
        mood 40以下+fear: 恐

    com以上dot的方式发挥效果。+
    多人运动时，以“命令某人”com夺舍他人做某事
    持续执行的com以tag形式存在，每次执行推进时间时根据tag添加dot、添加口上
    com:1点击=》2增减tag =》3计算dot =》4计算source =》5计算palam =》6计算衍生tag（绝顶）=》7检查素质和刻印的获取 =》8计算口上
    在每一步中都要写log，根据log生成对应口上
    显示结构：com执行判断+com地文+palam变化+衍生tag+素质/刻印获取+素质/刻印获取口上

    liquidPlace 存储体表液体有多少这样的抽象内容
    从内部流出的液体、外射的液体都直接储存在liquid——place，直到洗净这样的行为发生。

    todo
    人物的一些特别显示，如体表的液体，储液器官的膨胀(变更为器官的储液量吧)

2023-4-23
    人物的特别状态，比如执行的命令，特殊派生，tags放在commandmeun上方
    tags:
        特殊状态:射精、绝顶、中出、喷乳、快去了
        动作：xx位、xx装备，捆绑类型、肢体捆绑、插入位置、肢体占用指令
        tag派生类：可移动、可使用设施、锁结
    带有调教状态时不可执行移动、使用设施等行为
    当目标对象脱离观测时，结束非工作类持续tag
    新想法：改装调教用具，如装卸模块式按摩棒
    tags作为新类增加。
    tags有type【tag的tags】，name，inf（携带信息）,visiable（对玩家是否可见），来源指令，描述、dot效果等
    tags管理函数:
        1.查询角色是否有特定tag
        2.新增tag
        3.删除tag
        4.tags派生tag
        5.

2023-5-5
tag生效类型：持续型、source条件型


dot 类
格式[{source:string,value:number,type:string,inf?:any}]
type列表：
    once,立即增加到source
    permin,每分钟增加到source
    noless,低于阈值时触发
    nohigher，高于阈值时触发
    keep,维持在某个值
    fix,固定在某个值

2023-5-8
sourceUp里有个msg，如果使用短时计算的话，会大量显示
对所有人采用短时计算，
这样对于一些特殊状态可以进行多次处理


2023-5-23
发现无法保存类对象，
每个需要保存的类要构建序列化方法

NPC的自主行动：
    需要根据日程表安排接下来的任务
    需要根据情况穿插优先任务
    根据当前执行的任务，可以派生新的任务

    人物口上实例化在人物卡中，方便对日程表，装具进行调整
    大任务：时间、地点、人物？、装具、
        0.检查空闲，有无优先任务或正在执行的任务，如果没有，挂载需要执行的任务
        1.检查时间
        2.检查地点
        3.检查装具
        4.执行动作
        5.设置结束任务计时

    特殊任务：闲置，根据情况转化为别的任务

    正在执行的任务挂载在人物卡的todo属性中
    
    考虑在kojo中加入人物专属交互动作

    常见大任务：逗留，睡觉，使用设施，闲置

    设施产生的任务：使用需求，自主使用概率，tag，修正使用概率，注册设施特有任务

2023-5-25
    将action改造为描述npc行动的专用数据结构
    actPart需要使用的身体部位
    effect
    id
    name
    placementment 固定场地
    setting
    tags 需要的场地tag
    targetPart
    type

    新增preset，描述需要替换的服装，并非强制要求着装，如果人物的口上有就替换仅以名字命名
    新增stopabe，可否打断
    新增stopEffect, 停止处理

    可以从建筑中新增新的action
    exection的时候记录当前执行的action

    除了palam操作以外的dot，包括需要额外判断、处理、加成的dot依然以tag形式保存，同时进行处理
    通过tag增加exp?

2023-6-25
    exp转化为时间吧，部分exp如腔射经验转化为ml
    这个东西还没做
    人物可以成功到达位置，但还没有测试执行动作

2023-6-26
    人物到达后可以执行动作
    Tag增加人物经验，已完成
    tag新增了buff效果，可以对source的增减倍率进行修改
    之后的计划：
        填充更多的tag和基本的task
        如低health导致的昏迷，某些palam过高产生的衰减补正和对于其他palam的影响


2023-7-21
    需要加入根据tag增减或者持续触发的口上

2023-7-22
    让角色跟随的时候要先让角色停止task，有些task需要在特定地点结束

2023-8-12
    液体相关需要额外函数实现，tag仅存储动作有无发生
    高潮相关需要额外函数实现，当快感累计到一定程度时判断发生条件
    tag昏迷无法自动触发(已解决)

2023-9-18
    大体教育思路为：
    每次至多指定一名学生作为重点培养对象，其余学生执行自动任务
    被指定的学生可以命令跟随、授业
    未被指定的学生可以进行日常交互

    对于选定的target，可以加入随机的一句对于外貌的描述

    部分持续性指令的tag产生的dot由com.effect()生成

    T.msg和P.msgd的区别在哪里

    需要将comorder的计算结果列出来，写在T.order里